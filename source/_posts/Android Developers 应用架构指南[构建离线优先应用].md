---
title: Android Developers 应用架构指南[构建离线优先应用]
date: 2024-07-11 23:00:00
tags: [Android]
categories: [应用架构指南]
---
离线优先应用是无需访问互联网就能执行全部核心功能或一部分关键核心功能的应用。也就是说，它可以离线执行部分或全部业务逻辑。

构建离线优先应用首先要考虑数据层，它提供对应用数据和业务逻辑的访问。应用可能需要不时刷新这些来自设备外部来源的数据。为此，它可能需要调用网络资源来保持更新。

网络的可用性并不一定总是能得到保证。设备往往免不了会遇到网络连接不稳定或速度缓慢的问题。用户也可能会遇到以下情况：

- 互联网带宽有限。
- 连接短暂中断，例如在电梯或隧道中。
- 偶尔才能访问数据。例如，使用的平板电脑仅支持 Wi-Fi 连接。

不管原因如何，应用通常可以在上述情况下正常运行。为了确保应用可在离线状态下正常运行，它应该具备以下能力：

- 在没有可靠网络连接的情况下仍可使用。
- 立即向用户提供本地数据，而不是等待第一次网络调用完成或失败。
- 提取数据的方式考虑到电池和数据状态。例如，仅在理想情况下（例如充电或有 Wi-Fi 连接时）请求提取数据。

满足上述标准的应用通常称为离线优先应用。

# 设计离线优先应用
在设计离线优先应用时，首先应该设计数据层以及您可以对应用数据执行的以下两项主要操作：

- **读取**：检索数据以供应用的其他部分使用，例如向用户显示信息。
- **写入**：持久存储用户输入供日后检索之用。

数据层中的存储库负责组合数据源以提供应用数据。在离线优先应用中，必须至少有一个数据源无需访问网络即可执行其最关键的任务。其中一项关键任务是读取数据。
> 注意：离线优先应用至少应能在不访问网络的情况下执行读取操作。

# 模型数据
对于需要使用网络资源的每个存储库，离线优先应用至少有 2 个数据源：

- 本地数据源
- 网络数据源

![图 1：离线优先存储库](https://developer.android.google.cn/static/images/topic/architecture/data-layer/data-layer.png?hl=zh-cn)

> 注意：离线优先应用中需要访问网络数据源的存储库应当始终具有本地数据源。











