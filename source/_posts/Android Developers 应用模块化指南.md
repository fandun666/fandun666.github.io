---
title: Android Developers 应用模块化指南
date: 2024-07-12 09:00:00
tags: [Android]
categories: [应用架构]
---
模块化是按多个松散耦合的独立部分整理代码库的做法。每个部分都是一个模块。每个模块都是独立的，并且都有明确的用途。通过将问题划分为更小、更易于解决的子问题，您可以降低设计和维护大型系统的复杂性。

![图 1：多模块代码库示例的依赖关系图](https://developer.android.google.cn/static/topic/modularization/images/1_sample_dep_graph.png?hl=zh-cn)

# 高内聚和低耦合原则
表征模块化代码库的一种方式是使用耦合和内聚属性。耦合用于衡量模块相互依赖的程度。在本指南中，内聚用于衡量单个模块的不同元素在功能上的相关性。一般而言，您应尽力实现低耦合和高内聚：

- **低耦合**是指模块应尽可能相互独立，这样一来，对一个模块所做的更改将对其他模块产生零影响或极小的影响。模块相互之间不应了解对方的内部运行原理。
- **高内聚**是指多个模块的代码集合应当像一个系统一样运行。它们应具有明确定义的职责，并始终位于特定领域知识范围以内。假设有一个电子书应用示例。在同一个模块中融合图书相关代码和付款相关代码是不合适的，因为图书和付款是两个不同的功能领域。

> 提示：如果两个模块相互严重依赖对方的信息，则可能表明这两个模块应当作为一个系统运行。相反，如果一个模块的两个部分并不经常相互交互，则这两个部分应当成为两个独立模块。

# 模块类型
您主要依赖于应用架构来组织模块。下面列出了您在遵循我们推荐的应用架构的同时，可以在应用中引入的一些通用模块类型。

## 数据模块
数据模块通常包含存储库、数据源和模型类。数据模块的三个主要职责包括：

1. 封装特定领域的所有数据和业务逻辑：每个数据模块都应负责处理表示特定领域的数据。它可以处理许多类型的数据，只要这些数据相关即可。
2. 将存储库公开为外部 API：数据模块的公共 API 应为存储库，因为它们负责向应用的其余部分公开数据。
3. 对外部隐藏所有实现细节和数据源：只能由同一模块中的存储库访问数据源。它们对外部始终处于隐藏状态。您可以使用 Kotlin 的**private**或**internal**可见性关键字来实现此操作。

![图 1. 示例数据模块及其内容。](https://developer.android.google.cn/static/topic/modularization/images/2_data_modules.png?hl=zh-cn)

## 功能模块
功能是应用功能的独立部分，通常对应于一个屏幕或一系列密切相关的屏幕，例如注册或结账流程。如果您的应用具有底部导航栏，则每个目标位置都可能是一项功能。
> 关键术语：“功能模块”也是 Play Feature Delivery 中使用的一个术语，用于描述可以按条件分发或按需下载的模块。不过，在本指南中，功能模块是指用于封装应用功能不同部分的模块。

![图 2. 此应用的每个标签页均可定义为功能。](https://developer.android.google.cn/static/topic/modularization/images/2_bottom_bar.png?hl=zh-cn)

功能与应用中的页面或目标位置相关联。因此，它们可能具有相关联的界面和**ViewModel**，用于处理其逻辑和状态。一项功能并不一定仅限于单一视图或导航目标位置。功能模块依赖于数据模块。

![图 3. 功能模块及其内容示例。](https://developer.android.google.cn/static/topic/modularization/images/2_feature_modules.png?hl=zh-cn)

## 应用模块
应用模块是应用的入口点。它们依赖于功能模块，并且通常提供根导航。由于支持 build 变体，因此单个应用模块可以编译为许多不同的二进制文件。

![图 4. *演示版*和*完整版*产品变种模块依赖关系图。](https://developer.android.google.cn/static/topic/modularization/images/2_demo_full_dep_graph.png?hl=zh-cn)

如果您的应用以多种设备类型（例如汽车、穿戴式设备或电视）为目标平台，请分别为每种设备类型定义一个应用模块。这有助于分离特定于平台的依赖项。

![图 5. Wear 应用依赖关系图。](https://developer.android.google.cn/static/topic/modularization/images/2_wear_dep_graph.png?hl=zh-cn)

## 通用模块
通用模块（也称为核心模块）包含其他模块经常使用的代码。它们可减少冗余，并且不代表应用架构中的任何特定层。下面列出了通用模块的一些示例：

- **界面模块**：如果您在应用中使用自定义界面元素或精心设计品牌元素，则应考虑将 widget 集合封装到一个模块中，以便重复使用所有功能。这有助于确保您的界面在不同功能之间保持一致。例如，如果您采用集中式主题，则在更换品牌名称时可以避免痛苦的重构过程。
- **分析模块**：跟踪通常取决于业务需求，而几乎不用考虑软件架构。分析跟踪器经常应用于许多不相关的组件。如果是这种情况，最好创建一个专用分析模块。
- **网络模块**：当许多模块需要网络连接时，您可以考虑创建一个专用于提供 http 客户端的模块。当客户端需要自定义配置，该模块尤为实用。
- **实用程序模块**：实用程序（也称为辅助程序）通常是在应用中重复使用的小段代码。实用程序的示例包括测试辅助程序、货币格式设置函数、电子邮件验证程序和自定义运算符。

## 测试模块
测试模块是仅用于测试用途的 Android 模块。 这些模块包含仅运行测试需要而应用运行时不需要的测试代码、测试资源和测试依赖项。测试模块可将测试专用代码与主应用分开，使模块代码更易于管理和维护。

- **共享测试代码**：如果您的项目中有多个模块，并且某些测试代码适用于多个模块，那么您可以创建一个测试模块来共享代码。这有助于减少代码重复，使测试代码更易于维护。共享测试代码可以包括实用程序类或函数（例如自定义断言或匹配器）以及测试数据（例如模拟 JSON 响应）。

- **更简洁的 build 配置**：测试模块可让您拥有更简洁的 build 配置，因为它们可以拥有自己的**build.gradle**文件。这样您就不必在应用模块的**build.gradle**文件中堆满仅用于测试的配置。

- **集成测试**：测试模块可用于存储集成测试，这些测试用于测试应用的不同部分（包括界面、业务逻辑、网络请求和数据库）之间的互动查询。

- **大型应用**：测试模块对于具有复杂代码库和多个模块的大型应用特别有用。在这种情况下，测试模块可以帮助改进代码的组织和可维护性。

![图 6. 测试模块可用于隔离原本相互依赖的模块。](https://developer.android.google.cn/static/topic/modularization/images/2_test_modules.png?hl=zh-cn)

# 模块间通信
很少有模块是完全隔离的。模块之间通常相互依赖并相互通信。即使多个模块协同运行并频繁交换信息，也务必要保持低耦合。有时，与架构约束一样，两个模块之间进行直接通信是不可取的方式。此外，在使用循环依赖项等情况下，两个模块直接进行通信也是不可行的。
