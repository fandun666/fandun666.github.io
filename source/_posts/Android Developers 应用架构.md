---
title: Android Developers 应用架构
date: 2024-07-10 19:54:38
tags: [Android]
categories: [Android]
---
典型的 **Android** 应用包含多个应用组件，包括 **Activity** 、 **Fragment** 、 **Service** 、 **ContentProvider** 和 **BroadcastReceiver** 。您需要在应用清单中声明其中的大多数应用组件。 **Android** 操作系统随后会使用此文件来决定如何将您的应用集成到设备的整体用户体验中。鉴于典型的 **Android** 应用可能包含多个组件，并且用户经常会在短时间内与多个应用进行互动，因此应用需要适应不同类型的用户驱动型工作流和任务。

请注意，移动设备的资源也很有限，因此操作系统可能随时终止某些应用进程以便为新的进程腾出空间。

鉴于这种环境条件，您的应用组件可以不按顺序地单独启动，并且操作系统或用户可以随时销毁它们。由于这些事件不受您的控制，因此您不应在内存中存储或保留任何应用数据或状态，并且应用组件不应相互依赖。
# 简介
## 常见的架构原则
如果您不应使用应用组件存储应用数据和状态，那么您应该改为如何设计应用呢？

随着 **Android** 应用大小不断增加，您定义的架构务必要能允许应用扩缩、提升应用的稳健性并且方便对应用进行测试。

应用架构定义了应用的各个部分之间的界限以及每个部分应承担的职责。为了满足上述需求，您应该按照某些特定原则设计应用架构。
### 分离关注点
要遵循的最重要的原则是分离关注点。 一种常见的错误是在一个 **Activity** 或 **Fragment** 中编写所有代码。这些基于界面的类应仅包含处理界面和操作系统交互的逻辑。您应使这些类尽可能保持精简，这样可以避免许多与组件生命周期相关的问题，并提高这些类的可测试性。

请注意，您并非拥有 **Activity** 和 **Fragment** 的实现；它们只是表示 **Android** 操作系统与应用之间关系的粘合类。操作系统可能会根据用户互动或因内存不足等系统条件随时销毁它们。为了提供令人满意的用户体验和更易于管理的应用维护体验，最好尽量减少对它们的依赖。
### 通过数据模型驱动界面
另一个重要原则是您应该通过数据模型驱动界面（最好是持久性模型）。数据模型代表应用的数据。它们独立于应用中的界面元素和其他组件。这意味着它们与界面和应用组件的生命周期没有关联，但仍会在操作系统决定从内存中移除应用的进程时被销毁。

持久性模型是理想之选，原因如下：
- 如果 **Android** 操作系统销毁应用以释放资源，用户不会丢失数据。
- 当网络连接不稳定或不可用时，应用会继续工作。
如果您的应用架构以数据模型类为基础，您的应用会更便于测试、更稳定可靠。
### 单一数据源
在应用中定义新数据类型时，您应为其分配单一数据源 (**SSOT**)。**SSOT** 是该数据的所有者，而且只有此 **SSOT** 可以修改或转变该数据。为了实现这一点，**SSOT** 会以不可变类型公开数据；而且为了修改数据，**SSOT** 会公开函数或接收其他类型可以调用的事件。

此模式具有多种优势：
- 将对特定类型数据的所有更改集中到一处。
- 保护数据，防止其他类型篡改此数据。
- 更易于跟踪对数据的更改。因此，也就更容易发现 bug。
在离线优先应用中，应用数据的单一数据源通常是数据库。在其他某些情况下，单一数据源可以是 **ViewModel** 甚至是界面。
### 单向数据流
在我们的指南中，单一数据源原则常常与单向数据流 (**UDF**) 模式一起使用。在 **UDF** 中，状态仅朝一个方向流动。修改数据的事件朝相反方向流动。

在 **Android** 中，状态或数据通常从分区层次结构中较高的分区类型流向较低的分区类型。事件通常在分区层次结构中较低的分区类型触发，直到其到达 **SSOT** 的相应数据类型。例如，应用数据通常从数据源流向界面。用户事件（例如按钮按下操作）从界面流向 **SSOT**，在 **SSOT** 中应用数据被修改并以不可变类型公开。

此模式可以更好地保证数据一致性，不易出错、更易于调试，并且具备 **SSOT** 模式的所有优势。










